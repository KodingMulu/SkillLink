// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  FREELANCER
  CLIENT
  ADMIN
}

enum JobStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ProposalStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum UserStatus {
  ACTIVE
  PENDING
  SUSPENDED
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  PAYMENT_OUT 
  PAYMENT_IN 
  REFUND
}

model User {
  id       String     @id @default(cuid())
  email    String     @unique
  username String?
  password String
  role     Role       @default(FREELANCER)
  status   UserStatus @default(ACTIVE)

  title    String?
  bio      String? @db.Text
  phone    String?
  location String?

  skills     String[]
  proposals  Proposal[]
  projects   Project[]
  wallet     Wallet?
  clientJobs Job[]       @relation("ClientJobs")
  portfolios Portfolio[]

  verificationCode    String?
  verificationExpires DateTime?
  isVerified          Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Portfolio {
  id          String   @id @default(cuid())
  title       String
  description String
  image       String?
  link        String?
  tags        String[]

  userId String
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
}

model Job {
  id              String    @id @default(cuid())
  title           String
  description     String
  category        String
  budget          Float
  deadline        DateTime?
  location        String?
  duration        String?
  experienceLevel String?
  
  status          JobStatus @default(OPEN)
  tags            String[]

  clientId String
  client   User   @relation("ClientJobs", fields: [clientId], references: [id])

  proposals Proposal[]
  project   Project?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Proposal {
  id          String         @id @default(cuid())
  coverLetter String
  bidAmount   Float
  status      ProposalStatus @default(PENDING)

  jobId        String
  job          Job    @relation(fields: [jobId], references: [id])
  freelancerId String
  freelancer   User   @relation(fields: [freelancerId], references: [id])
}

model Project {
  id       String    @id @default(cuid())
  status   JobStatus @default(IN_PROGRESS)
  progress Int       @default(0)

  jobId        String @unique
  job          Job    @relation(fields: [jobId], references: [id])
  freelancerId String
  freelancer   User   @relation(fields: [freelancerId], references: [id])

  review    Review?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Wallet {
  id      String @id @default(cuid())
  balance Decimal @db.Decimal(15, 2) @default(0)

  bankName      String?
  accountNumber String?
  accountHolder String?

  userId       String        @unique
  user         User          @relation(fields: [userId], references: [id])
  transactions Transaction[]
}

model Transaction {
  id     String            @id @default(cuid())
  amount Decimal @db.Decimal(15, 2)
  type   TransactionType
  status TransactionStatus @default(COMPLETED)

  walletId  String
  wallet    Wallet   @relation(fields: [walletId], references: [id])
  createdAt DateTime @default(now())
}

model Review {
  id      String  @id @default(cuid())
  rating  Int
  comment String?

  projectId String  @unique
  project   Project @relation(fields: [projectId], references: [id])

  createdAt DateTime @default(now())
}